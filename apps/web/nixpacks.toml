[phases.setup]
# Node.js 20 required for workspace dependencies (pdf-parse, @vercel/blob)
nixPkgs = ["nodejs_20", "npm"]

[phases.install]
cmds = [
  "node --version",
  "yarn install --frozen-lockfile"
]

[phases.build]
cmds = [
  "npx prisma generate --schema=./packages/database/prisma/schema.prisma",
  "cd packages/database && npm run build && cd ../..",
  "cd apps/web && npm run build"
]

[start]
cmd = "cd apps/web && npm start"
