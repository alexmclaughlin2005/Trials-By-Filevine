[phases.setup]
# Node.js 20 required for workspace dependencies (pdf-parse, @vercel/blob)
nixPkgs = ["nodejs_20", "npm"]

[phases.install]
cmds = ["npm install"]

[phases.build]
cmds = [
  "npx prisma generate --schema=./packages/database/prisma/schema.prisma",
  "npm run build --workspace=@juries/database",
  "npm run build --workspace=@juries/collaboration-service"
]

[start]
cmd = "npm run start --workspace=@juries/collaboration-service"
