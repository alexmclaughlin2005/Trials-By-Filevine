# Case-Level Voir Dire Questions Implementation Plan

**Date:** January 30, 2026  
**Status:** Planning Phase  
**Priority:** High

---

## 1. Executive Summary

This plan outlines the implementation of case-level voir dire questions that can be asked to all jurors in a case. This includes:

1. **AI-generated case-level questions** - Generated based on case facts and strategy
2. **User-generated case-level questions** - Created manually by attorneys
3. **Juror-level discriminative questions** - Already implemented, specific to individual jurors
4. **Answer tracking** - Each juror can answer any case-level question
5. **General notes** - Enhanced notes functionality for each juror

---

## 2. Requirements

### 2.1 Functional Requirements

#### FR1: Case-Level Question Management
- Users can create, edit, and delete case-level voir dire questions
- Questions can be marked as AI-generated or user-generated
- Questions can be organized by category (optional)
- Questions can be reordered/prioritized
- Questions can be marked as active/inactive

#### FR2: Question Types
- **AI-Generated Questions:** Generated by voir dire generator service based on case facts
- **User-Generated Questions:** Created manually by attorneys
- **Discriminative Questions:** Already exists, juror-specific (keep as-is)

#### FR3: Answering Questions
- Each juror can answer any case-level question
- Answers are stored as `VoirDireResponse` records
- Link `VoirDireResponse` to case-level question via `questionId`
- Support for multiple answers to the same question (if asked multiple times)

#### FR4: General Notes
- Each juror has a general notes field (already exists in schema)
- Notes are separate from voir dire responses
- Notes should be always-editable (not just in edit mode)
- Notes should support rich text (optional, Phase 2)

### 2.2 Data Model

#### New Model: `CaseVoirDireQuestion`

```prisma
model CaseVoirDireQuestion {
  id              String   @id @default(uuid())
  caseId          String   @map("case_id")
  questionText    String   @map("question_text") @db.Text
  questionType    String   @map("question_type") // AI_GENERATED | USER_CREATED
  questionCategory String? @map("question_category") // Optional categorization
  source          String?  // If AI-generated, reference to generation source
  sortOrder       Int      @default(0) @map("sort_order")
  isActive        Boolean  @default(true) @map("is_active")
  createdBy       String   @map("created_by")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  // Relations
  case      Case                @relation(fields: [caseId], references: [id], onDelete: Cascade)
  responses VoirDireResponse[]

  @@index([caseId])
  @@index([isActive])
  @@map("case_voir_dire_questions")
}
```

#### Update `VoirDireResponse` Model

The `questionId` field already exists and can reference either:
- `SuggestedQuestion.id` (for discriminative questions)
- `CaseVoirDireQuestion.id` (for case-level questions)

We'll need to add a relation or handle this polymorphically.

Actually, let's check - `VoirDireResponse.questionId` is currently `String?`. We can use it to reference either type. We might want to add a `questionType` field to distinguish, or we can infer from the questionId by checking which table it exists in.

For simplicity, let's add a `questionType` field to `VoirDireResponse`:
- `DISCRIMINATIVE` - Links to SuggestedQuestion
- `CASE_LEVEL` - Links to CaseVoirDireQuestion
- `CUSTOM` - No link, custom question text

---

## 3. Technical Design

### 3.1 Database Changes

**New Migration:**
1. Create `CaseVoirDireQuestion` model
2. Add `questionType` field to `VoirDireResponse` (optional, can infer)
3. Add relation from `CaseVoirDireQuestion` to `VoirDireResponse`

### 3.2 API Endpoints

#### Case-Level Questions

```
POST   /api/cases/:caseId/voir-dire-questions
GET    /api/cases/:caseId/voir-dire-questions
PATCH  /api/cases/:caseId/voir-dire-questions/:questionId
DELETE /api/cases/:caseId/voir-dire-questions/:questionId
POST   /api/cases/:caseId/voir-dire-questions/generate-ai
```

#### Juror Notes

```
PATCH  /api/jurors/:jurorId/notes
```

### 3.3 Frontend Components

1. **CaseVoirDireQuestionsManager** - Manage case-level questions (case page)
2. **CaseVoirDireQuestionList** - List questions for answering (juror sidebar)
3. **JurorNotesEditor** - Enhanced notes editor (juror sidebar)
4. **VoirDireResponseEntry** - Update to support case-level questions

---

## 4. Implementation Phases

### Phase 1: Database & Backend API
1. Create migration for `CaseVoirDireQuestion`
2. Create API routes for case-level questions CRUD
3. Create service for managing case-level questions
4. Add AI question generation endpoint
5. Update voir dire response to support case-level questions

### Phase 2: Frontend - Case-Level Management
1. Create `CaseVoirDireQuestionsManager` component
2. Add to case page/overview
3. Support creating, editing, deleting questions
4. Support AI generation

### Phase 3: Frontend - Juror Answering
1. Update `VoirDireResponseEntry` to show case-level questions
2. Create `CaseVoirDireQuestionList` component for juror sidebar
3. Allow selecting case-level questions to answer
4. Show which questions have been answered

### Phase 4: Enhanced Notes
1. Create `JurorNotesEditor` component
2. Make notes always-editable
3. Add auto-save functionality
4. Integrate into juror sidebar

---

## 5. File Structure

### Backend
```
services/api-gateway/src/
├── routes/
│   └── case-voir-dire-questions.ts  # NEW: Case-level question routes
├── services/
│   └── case-voir-dire-question-service.ts  # NEW: Business logic
```

### Frontend
```
apps/web/
├── components/
│   ├── case-voir-dire-questions/
│   │   ├── case-voir-dire-questions-manager.tsx  # NEW: Manage questions
│   │   └── case-voir-dire-question-list.tsx       # NEW: List for answering
│   └── juror/
│       └── juror-notes-editor.tsx                # NEW: Enhanced notes
├── hooks/
│   └── use-case-voir-dire-questions.ts           # NEW: React Query hooks
```

---

## 6. User Workflows

### 6.1 Creating Case-Level Questions

1. User navigates to case page
2. User opens "Voir Dire Questions" section
3. User can:
   - Click "Generate AI Questions" to create AI-generated questions
   - Click "Add Question" to create user-generated question
   - Edit/delete existing questions
   - Reorder questions

### 6.2 Answering Case-Level Questions

1. User opens juror sidebar
2. User navigates to "Voir Dire Responses" section
3. User sees list of case-level questions
4. User clicks "Answer" on a question
5. Modal opens with question pre-populated
6. User enters response
7. Response is saved and linked to the case-level question

### 6.3 Adding General Notes

1. User opens juror sidebar
2. User navigates to "Notes" section (always visible)
3. User types notes
4. Notes auto-save on blur
5. Notes are separate from voir dire responses

---

## 7. Open Questions

1. **Question Reuse:** Should we allow reusing questions from other cases?
2. **Question Templates:** Should we support question templates?
3. **Bulk Answering:** Should we support answering the same question for multiple jurors at once?
4. **Question Categories:** What categories should we support? (Opening, Case-Specific, Challenge for Cause, etc.)
5. **Notes Formatting:** Should notes support rich text or stay plain text?

---

## 8. Success Metrics

- % of cases with at least one case-level question
- Average number of case-level questions per case
- % of jurors who have answered at least one case-level question
- Average number of answers per case-level question

---

**Document Status:** Ready for Implementation  
**Last Updated:** January 30, 2026
